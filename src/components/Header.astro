---
import { Image } from "astro:assets";
import {
  Menu,
  X,
  ChevronDown,
  Home,
  Users,
  Newspaper,
  FileText,
  Shield,
  BookOpen,
  Calendar,
  Download,
  HelpCircle,
  Phone,
  UserCheck,
  ClipboardList,
  Building,
  Award,
  Settings,
} from "lucide-astro";
import AccessibilityMenu from "./AccessibilityMenu.astro";
import logo from "@assets/logo/LogoSMKN14.png";

const links = [
  {
    name: "Beranda",
    href: "/",
    icon: Home,
    hasDropdown: false,
  },
  {
    name: "Profil",
    href: "/profil",
    icon: Users,
    hasDropdown: true,
    dropdown: [
      { name: "Profil Singkat", href: "/profil" },
      { name: "Sambutan Penanggung Jawab", href: "/profil/sambutan" },
      { name: "Visi & Misi", href: "/profil/visi-misi" },
      { name: "Maklumat", href: "/profil/maklumat" },
      { name: "Struktur Organisasi PPID & SK", href: "/profil/struktur" },
      { name: "Tugas dan Fungsi", href: "/profil/tugas-dan-fungsi" },
      { name: "Pejabat Struktural", href: "/profil/pejabat-struktural" },
    ],
  },
  {
    name: "Berita",
    href: "/berita",
    icon: Newspaper,
    hasDropdown: false,
  },
  {
    name: "Standar Layanan",
    href: "/standar-layanan",
    icon: UserCheck,
    hasDropdown: true,
    dropdown: [
      { name: "Prosedur Permohonan Informasi", href: "/standar-layanan/prosedur-permohonan-informasi" },
      { name: "Standar Operasional Prosedur (SOP)", href: "/standar-layanan/standar-operasional-prosedur" },
      { name: "Mekanisme Permohonan Informasi", href: "/standar-layanan/mekanisme-permohonan-informasi" },
      { name: "Mekanisme Pengajuan Permohonan Penyelesaian Sengketa", href: "/standar-layanan/mekanisme-penyelesaian-sengketa" },
      { name: "Mekanisme Pengajuan Keberatan", href: "/standar-layanan/mekanisme-pengajuan-keberatan" },
    ],
  },
  {
    name: "Regulasi",
    href: "/regulasi",
    icon: FileText,
    hasDropdown: true,
    dropdown: [
      { name: "Peraturan Gubernur", href: "/regulasi/peraturan-gubernur" },
      { name: "Peraturan Daerah", href: "/regulasi/peraturan-daerah" },
      { name: "Instruksi Gubernur", href: "/regulasi/instruksi-gubernur" },
      { name: "Surat Edaran", href: "/regulasi/surat-edaran" },
      { name: "Rancangan Peraturan", href: "/regulasi/rancangan-peraturan" },
      { name: "Produk Hukum", href: "/regulasi/produk-hukum" },
    ],
  },
  {
    name: "PPID",
    href: "/ppid",
    icon: Shield,
    hasDropdown: true,
    dropdown: [
      { name: "Daftar Informasi Publik", href: "/ppid/daftar-informasi-publik" },
      { name: "Laporan PPID", href: "/ppid/laporan-ppid" },
      { name: "Statistik Layanan Informasi", href: "/ppid/statistik-layanan-informasi" },
      { name: "Form Permohonan Informasi", href: "/ppid/form-permohonan-informasi" },
      { name: "Form Keberatan Informasi Publik", href: "/ppid/form-keberatan-informasi" },
      { name: "Form Survei Kepuasan", href: "/ppid/form-survei-kepuasan" },
      { name: "Form Pengaduan", href: "/ppid/form-pengaduan" },
    ],
  },
  {
    name: "Pedoman",
    href: "/pedoman",
    icon: BookOpen,
    hasDropdown: true,
    dropdown: [
      { name: "Pedoman Pengelolaan Organisasi", href: "/pedoman/pedoman-pengelolaan-organisasi" },
      { name: "Pedoman Pengelolaan Administrasi", href: "/pedoman/pedoman-pengelolaan-administrasi" },
      { name: "Pedoman Pengelolaan Kepegawaian", href: "/pedoman/pedoman-pengelolaan-kepegawaian" },
      { name: "Pedoman Pengelolaan Keuangan", href: "/pedoman/pedoman-pengelolaan-keuangan" },
    ],
  },
  {
    name: "Agenda",
    href: "/agenda",
    icon: Calendar,
    hasDropdown: false,
  },
  {
    name: "Pengumuman",
    href: "/pengumuman",
    icon: ClipboardList,
    hasDropdown: false,
  },
  {
    name: "Download",
    href: "/download",
    icon: Download,
    hasDropdown: false,
  },
  {
    name: "FAQ",
    href: "/faq",
    icon: HelpCircle,
    hasDropdown: false,
  },
  {
    name: "Hubungi",
    href: "/kontak",
    icon: Phone,
    hasDropdown: false,
  },
];
---

<header class="bg-primary shadow-lg sticky top-0 z-50 backdrop-blur-md border-b border-white/10">
  <div class="container mx-auto px-4">
    <div class="flex flex-col  items-center justify-around py-4 gap-4">
      <!-- Logo Section -->
      <div class="flex items-center justify-center lg:justify-start group">
        <a href="/" class="flex items-center transform transition-all duration-300 hover:scale-105">
          <div class="relative">
            <div class="absolute inset-0 bg-white/20 rounded-full blur-xl group-hover:bg-white/30 transition-all duration-300"></div>
            <Image
              src={logo}
              alt="Logo PPID SMKN 14 Jakarta"
              width={56}
              height={56}
              format="webp"
              quality={90}
              class="h-14 w-auto relative z-10 drop-shadow-lg"
            />
          </div>
          <div class="ml-4">
            <span class="text-2xl font-bold text-white tracking-tight">PPID</span>
            <div class="text-sm text-blue-100 font-medium tracking-wide">SMKN 14 Jakarta</div>
          </div>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center space-x-1">
        {links.map((link) => (
          <div class="relative group">
            <a
              href={link.href}
              class:list={[
                "flex items-center px-4 py-2 rounded-lg text-white font-medium transition-all duration-300 hover:bg-white/10 hover:backdrop-blur-sm hover:shadow-lg hover:-translate-y-0.5",
                {
                  "bg-white/20 backdrop-blur-sm shadow-lg border border-white/20":
                    Astro.url.pathname === link.href,
                },
              ]}
            >
              {link.icon && <link.icon class="w-4 h-4 mr-2 opacity-80" />}
              <span class="whitespace-nowrap">{link.name}</span>
              {link.hasDropdown && (
                <ChevronDown class="w-4 h-4 ml-1 transform group-hover:rotate-180 transition-transform duration-300" />
              )}
            </a>

            <!-- Desktop Dropdown Menu -->
            {link.hasDropdown && link.dropdown && (
              <div class="absolute top-full left-0 mt-1 w-64 bg-white backdrop-blur-md rounded-xl shadow-2xl border border-white/20  invisible group-hover:opacity-100 group-hover:visible transform translate-y-1 group-hover:translate-y-0 transition-all duration-300 pointer-events-none group-hover:pointer-events-auto z-50">
                <div class="py-2">
                  {link.dropdown.map((dropdownItem) => (
                    <a
                      href={dropdownItem.href}
                      class="block px-4 py-3 text-gray-700 hover:text-primary hover:bg-primary/5 transition-all duration-200 border-l-4 border-transparent hover:border-primary first:rounded-t-xl last:rounded-b-xl"
                    >
                      {dropdownItem.name}
                    </a>
                  ))}
                </div>
                <!-- Invisible hover bridge to prevent dropdown disappearing -->
                <div class="absolute -top-2 left-0 right-0 h-3 bg-transparent -z-10"></div>
              </div>
            )}
          </div>
        ))}
      </nav>

      <!-- Mobile Menu Toggle -->
      <div class="lg:hidden">
        <input type="checkbox" id="mobile-menu-toggle" class="peer hidden" />
        <label
          for="mobile-menu-toggle"
          class="relative p-2 text-white hover:bg-white/10 rounded-lg cursor-pointer transition-all duration-300 block"
        >
          <!-- Menu Icon -->
          <Menu class="h-6 w-6 transition-all duration-300 peer-checked:opacity-0 peer-checked:rotate-90 peer-checked:scale-0" />
          <!-- Close Icon -->
          <X class="h-6 w-6 absolute top-2 left-2 transition-all duration-300 opacity-0 rotate-90 scale-0 peer-checked:opacity-100 peer-checked:rotate-0 peer-checked:scale-100" />
        </label>

        <!-- Mobile Menu -->
        <div class="lg:hidden bg-white/95 backdrop-blur-xl border-t border-white/20 shadow-2xl max-h-0 overflow-hidden transition-all duration-500 ease-out peer-checked:max-h-screen">


    <!-- Mobile Navigation -->
    <nav class="p-6">
      {links.map((link, index) => (
        <div class="opacity-100 transition-all duration-300 peer-checked:opacity-100 peer-checked:translate-y-0" style={`transition-delay: ${(index + 2) * 50}ms`}>
          <div class="relative">
            {link.hasDropdown ? (
              <>
                <input type="checkbox" id={`mobile-dropdown-${index}`} class="peer hidden dropdown-toggle" />
                <label
                  for={`mobile-dropdown-${index}`}
                  class="flex items-center px-4 py-3 rounded-xl text-gray-700 font-medium transition-all duration-300 hover:bg-primary/10 hover:text-primary hover:translate-x-2 cursor-pointer"
                >
                  {link.icon && (
                    <link.icon class="w-5 h-5 mr-3 opacity-70 transition-opacity duration-300" />
                  )}
                  <span class="flex-1">{link.name}</span>
                  <ChevronDown class="w-4 h-4 opacity-50 transform peer-checked:rotate-180 transition-transform duration-300" />
                </label>
              </>
            ) : (
              <a
                href={link.href}
                class:list={[
                  "flex items-center px-4 py-3 rounded-xl text-gray-700 font-medium transition-all duration-300 hover:bg-primary/10 hover:text-primary hover:translate-x-2",
                  {
                    "bg-primary/20 text-primary shadow-sm border-l-4 border-primary":
                      Astro.url.pathname === link.href,
                  },
                ]}
              >
                {link.icon && (
                  <link.icon class="w-5 h-5 mr-3 opacity-70 transition-opacity duration-300" />
                )}
                <span class="flex-1">{link.name}</span>
              </a>
            )}

            <!-- Mobile Dropdown -->
            {link.hasDropdown && link.dropdown && (
              <div class="ml-8 mt-2 space-y-1 max-h-0 overflow-hidden transition-all duration-300 dropdown-content">
                {link.dropdown.map((dropdownItem, dropdownIndex) => (
                  <a
                    href={dropdownItem.href}
                    class="block px-4 py-2 text-sm text-gray-600 hover:text-primary hover:bg-primary/5 rounded-lg transition-all duration-200 opacity-0 translate-x-4"
                    style={`transition-delay: ${dropdownIndex * 50}ms`}
                  >
                    {dropdownItem.name}
                  </a>
                ))}
              </div>
            )}
          </div>
        </div>
      ))}
    </nav>

    <!-- Mobile Contact Info -->
    <!-- <div class="px-4 py-6 border-t border-gray-200 bg-gray-50/80 opacity-0 translate-y-4 transition-all duration-300 delay-500 peer-checked:opacity-100 peer-checked:translate-y-0">
      <div class="space-y-3 text-sm text-gray-600">
        <div class="flex items-center transform hover:translate-x-1 transition-transform duration-200">
          <span class="mr-2">üìß</span>
          <span>info@smkn14jakarta.sch.id</span>
        </div>
        <div class="flex items-center transform hover:translate-x-1 transition-transform duration-200">
          <span class="mr-2">üìû</span>
          <span>(021) 123-4567</span>
        </div>
        <div class="flex items-center transform hover:translate-x-1 transition-transform duration-200">
          <span class="mr-2">üìç</span>
          <span>Jakarta Selatan</span>
        </div>
      </div>
    </div> -->
  </div>
</div>
</header>

<style>
  
  /* Fade in animation for mobile menu items */
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fade-in-up {
    animation: fade-in-up 0.3s ease-out forwards;
    opacity: 0;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Custom scrollbar */
  ::-webkit-scrollbar {
    width: 4px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(99, 102, 241, 0.3);
    border-radius: 2px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(99, 102, 241, 0.5);
  }

  /* Enhanced hover effects for better UX */
  @media (hover: hover) {
    .group:hover .group-hover\:max-h-96 {
      max-height: 24rem;
    }
  }

  /* Add subtle animation to icons */
  .group:hover svg {
    transform: scale(1.1);
  }

  /* Better focus states for accessibility */
  input[type="checkbox"]:focus + label,
  input[type="text"]:focus,
  a:focus {
    outline: 2px solid rgba(99, 102, 241, 0.5);
    outline-offset: 2px;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const dropdownToggles = document.querySelectorAll<HTMLInputElement>(".dropdown-toggle");

    dropdownToggles.forEach((toggle) => {
      toggle.addEventListener("change", () => {
        const parent = toggle.parentElement;
        if (!parent) return;

        const content = parent.querySelector<HTMLElement>(".dropdown-content");
        if (!content) return;

        const links = content.querySelectorAll("a");

        if (toggle.checked) {
          content.style.maxHeight = content.scrollHeight + "px";
          links.forEach(link => {
            link.classList.add("opacity-100", "translate-x-0");
            link.classList.remove("opacity-0", "translate-x-4");
          });
        } else {
          content.style.maxHeight = "0";
           links.forEach(link => {
            link.classList.remove("opacity-100", "translate-x-0");
            link.classList.add("opacity-0", "translate-x-4");
          });
        }
      });
    });
  });
  </script>
  
  <!-- Include Accessibility Menu -->
  <AccessibilityMenu />